#!/bin/bash

set -e

echo "============================================"
echo "Initializing Django Messaging App on Kubernetes"
echo "============================================"

echo ""
echo "[1] Setting Docker environment to use Minikube..."
eval $(minikube docker-env)

echo ""
echo "[2] Building Docker image for Minikube..."
cd /home/buomyian/alx-backend-python/messaging_app
docker build -t messaging-app:1.0 .

echo ""
echo "[3] Creating initial deployment..."
kubectl apply -f /home/buomyian/alx-backend-python/messaging_app/messaging_app/deployment.yaml

echo ""
echo "[4] Waiting for initial pod to be ready..."
kubectl wait --for=condition=ready pod -l app=messaging-app --timeout=120s 2>/dev/null || echo "Initial pod startup..."
sleep 10

echo ""
echo "[5] Verifying initial deployment:"
kubectl get deployments messaging-app

echo ""
echo "[6] Current pod status:"
kubectl get pods -l app=messaging-app -o wide

echo ""
echo "âœ… Initial deployment complete! You can now run ./kubctl-0x01 to scale the deployment."
