#!/bin/bash

set -e

echo "ğŸš€ Applying BLUE deployment..."
kubectl apply -f blue_deployment.yaml

echo "ğŸš€ Applying GREEN deployment..."
kubectl apply -f green_deployment.yaml

echo "ğŸ“¡ Applying service..."
kubectl apply -f kubeservice.yaml

echo "ğŸ” Checking logs for GREEN deployment..."
GREEN_POD=$(kubectl get pods --selector="version=green" -o jsonpath='{.items[0].metadata.name}')
kubectl logs $GREEN_POD --tail=50

echo "ğŸ“Œ Switch traffic to green by editing kubeservice.yaml selector:"
echo "app: messaging-app"
echo "version: green"

echo "Then apply again:"
echo "kubectl apply -f kubeservice.yaml"

echo "ğŸ‰ Blue-Green setup ready!"
